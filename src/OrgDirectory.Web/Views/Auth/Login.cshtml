@{
    ViewData["Title"] = "Вход";
    var returnUrl = ViewBag.ReturnUrl as string;
}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Bootstrap  -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">


<link rel="stylesheet" href="@Url.Content("~/css/register-glass.css")">


<style>
  :root { --auth-bg: url('@Url.Content("~/img/3a3d46.png")'); }
</style>

<div class="auth-shell">
  <div class="square sq1"></div>
  <div class="square sq2"></div>
  <div class="square sq3"></div>
  <div class="square sq4"></div>

  <div class="auth-card shadow-lg">
    <h2 class="auth-title mb-3">Вход</h2> 

    @if (TempData["Info"] != null)
    {
        <div class="alert alert-info small mb-3">@TempData["Info"]</div>
    }
    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger small mb-3">@ViewBag.Error</div>
    }

    <form method="post" action="/Auth/Login" novalidate class="auth-form">
      @Html.AntiForgeryToken()
      <input type="hidden" name="returnUrl" value="@returnUrl" />

      <div class="mb-3">
        <label for="loginOrEmail" class="visually-hidden">Email или логин</label>
        <input id="loginOrEmail"
               name="loginOrEmail"
               class="form-control form-control-lg rounded-pill auth-input"
               placeholder="Email или логин"
               autocomplete="username" />
      </div>

      <div class="mb-4 position-relative">
        <label for="password" class="visually-hidden">Пароль</label>
        <input id="password"
               name="password"
               type="password"
               class="form-control form-control-lg rounded-pill auth-input pe-5"
               placeholder="Пароль"
               autocomplete="current-password" />
        <button type="button"
                class="btn btn-link px-3 py-0 position-absolute top-50 end-0 translate-middle-y toggle-pass"
                data-toggle-password="#password">Показать</button>
      </div>

      <button type="submit" class="btn btn-light btn-lg rounded-pill w-100 fw-semibold auth-btn" id="loginBtn">
        Войти
        <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
      </button>

      <div class="auth-links text-center mt-3">
        <span class="text-light">Нет аккаунта?</span>
        <a asp-action="Register" asp-route-returnUrl="@returnUrl" class="label1 ms-2">Зарегистрироваться</a>
      </div>
    </form>
  </div>
</div>

@section Scripts {
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // показать/скрыть пароль
    document.querySelectorAll('.toggle-pass').forEach(btn => {
      btn.addEventListener('click', function () {
        const input = document.querySelector(this.dataset.togglePassword);
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        this.textContent = isPwd ? 'Скрыть' : 'Показать';
        input.focus();
      });
    });
    // блокировка кнопки + спиннер
    const form = document.querySelector('.auth-form');
    const loginBtn = document.getElementById('loginBtn');
    if (form && loginBtn) {
      form.addEventListener('submit', function () {
        loginBtn.disabled = true;
        loginBtn.querySelector('.spinner-border').classList.remove('d-none');
      });
    }
  </script>
}
